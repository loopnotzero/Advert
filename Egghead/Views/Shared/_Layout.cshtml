<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <title>Egghead.md – Cele mai bune publicații pe zi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description"/>
    <meta content="Coderthemes" name="author"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <link rel="shortcut icon" href="~/images/favicon.ico">
    <link href="~/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="~/css/style.css" rel="stylesheet" type="text/css"/>
    <link href="~/css/icons.css" rel="stylesheet" type="text/css"/>
    <link href="~/css/simplemde.css" rel="stylesheet" type="text/css">
    <link href="~/css/animate.css" rel="stylesheet" type="text/css">
    <link href="~/css/dropzone.css" rel="stylesheet" type="text/css"/>
</head>

<body id="body" data-ma-theme="egghead" style="display: none">

<script src="~/js/jquery.min.js"></script>
<script src="~/js/popper.js"></script>
<script src="~/js/bootstrap.min.js"></script>
<script src="~/js/waves.js"></script>
<script src="~/js/simplemde.js"></script>
<script src="~/js/egghead.js"></script>
<script src="~/js/dropzone.js"></script>

@RenderBody()
</body>
</html>

<script>
    $(window).on('load', function () {
        $('#body').fadeIn(200);
    });
    
    $(document).ready(function() {
        $("#log-in").click(function(e) {
            e.preventDefault();
            
            var url = $("#form").attr("action");
            var token = $("input[name=__RequestVerificationToken]").val();
            var email = $("#email").val();
            var password = $("#password").val();
            var additionalHeaders = {};

            if (token) {
                additionalHeaders["RequestVerificationToken"] = token;
            }

            $.ajax({
                url: url,
                type: "POST",
                data: JSON.stringify({ email: email, password: password }),
                headers: additionalHeaders,
                contentType: "application/json",
                error: function() {
                    console.log("Log in error");
                },
                success: function(response) {
                    window.location.href = response.returnUrl;
                }
            });

            return false;
        });
        
        $("#log-out").click(function(e) {
            e.preventDefault();
            $.ajax({
                url: "/Account/SignOut?returnUrl=" + window.location.pathname + window.location.search,
                type: "GET",
                contentType: "application/json",
                error: function(jqXhr, textStatus, errorThrown) {
                    console.log("Sign out error");
                },
                success: function(response) {
                    window.location.href = response.returnUrl;
                }
            });
            return false;
        });
        
        $("#sign-up").click(function(e) {
            e.preventDefault();
            
            var url = $("#form").attr("action");
            var token = $("input[name=__RequestVerificationToken]").val();
            var name = $("#name").val();
            var email = $("#email").val();
            var password = $("#password").val();
            var additionalHeaders = {};

            if (token) {
                additionalHeaders["RequestVerificationToken"] = token;
            }

            $.ajax({
                url: url,
                type: "POST",
                data: JSON.stringify({ name: name, email: email, password: password }),
                headers: additionalHeaders,
                contentType: "application/json",
                error: function() {
                    console.log("Sign up error");
                },
                success: function(response) {
                    console.log(response);
                    window.location.href = response.returnUrl;
                }
            });

            return false;
        });
      
        $("#compose-article").click(function(e) {
            e.preventDefault();
            window.location.href = "/Articles/ComposeArticle";
            return false;
        });
             
        function onVoteClick(articleId, voteType) {
            var vote = {
                voteType: voteType
            }
            $.ajax({
                url: "/Articles/CreateArticleVoteAsync?articleId=" + articleId,
                type: "POST",
                data: JSON.stringify(vote),
                contentType: "application/json",
                error: function(jqXhr, textStatus, errorThrown) {
                    console.log("jqXhr: " + jqXhr);
                    console.log("textStatus: " + jqXhr);
                    console.log("errorThrown: " + jqXhr);
                },
                success: function(response) {
                    switch (voteType) {
                    case 1:
                        {
                            $(`#${articleId} small[name=likes]`).text(response);
                        }
                        break;
                    case 2:
                        {
                            $(`#${articleId} small[name=dislikes]`).text(response);
                        }
                        break;
                    }

                }
            });
        }

        function onBookmarkClick(articleId) {
            $.ajax({
                url: "/Articles/GetProfileDescriptionAsync",
                type: "GET",
                contentType: "application/json",
                error: function(jqXhr, textStatus, errorThrown) {
                    console.log("jqXhr: " + jqXhr);
                    console.log("textStatus: " + jqXhr);
                    console.log("errorThrown: " + jqXhr);
                },
                success: function(response) {
                    $("#articles-preview").html(response);
                }
            });
        }
    });
</script>