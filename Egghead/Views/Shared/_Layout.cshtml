<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <title>Egghead.md – Cele mai bune publicații pe zi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description"/>
    <meta content="Coderthemes" name="author"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <link rel="shortcut icon" href="~/images/favicon.ico">
    <link href="~/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="~/css/style.css" rel="stylesheet" type="text/css"/>
    <link href="~/css/icons.css" rel="stylesheet" type="text/css"/>
    <link href="~/css/simplemde.css" rel="stylesheet" type="text/css">
    <link href="~/css/animate.css" rel="stylesheet" type="text/css">
</head>

<body data-ma-theme="cyan">
<script src="~/js/jquery.min.js"></script>
<script src="~/js/popper.js"></script>
<script src="~/js/bootstrap.min.js"></script>
<script src="~/js/waves.js"></script>
<script src="~/js/simplemde.js"></script>
<script src="~/js/egghead.js"></script>
@RenderBody()
</body>
</html>

<script>
    $(document).ready(function() {
        $(".content").fadeIn(200);
        
        $("#log-in").click(function(e) {
            e.preventDefault();
            
            var url = $("#form").attr("action");
            console.log("Request url: " + url);
            
            var token = $("input[name=__RequestVerificationToken]").val();
            console.log("Request verification token: " + token);
            
            var email = $("#email").val();
            console.log("Email: " + email);
            
            var password = $("#password").val();
            console.log("Password: " + password);

            var additionalHeaders = {};

            if (token) {
                additionalHeaders["RequestVerificationToken"] = token;
            }

            $.ajax({
                url: url,
                type: "POST",
                data: JSON.stringify({ email: email, password: password }),
                headers: additionalHeaders,
                contentType: "application/json",
                error: function(jqXhr, textStatus, errorThrown) {
                    console.log("jqXhr: " + JSON.stringify(jqXhr));
                    console.log("Text status: " + JSON.stringify(textStatus));
                    console.log("Error thrown: " + JSON.stringify(errorThrown));
                    //todo: Add form for reporting bug
                },
                success: function(response) {
                    console.log("Response: " + response);
                    console.log("Error message: " + response.errorMessage);
                    console.log("Error status code: " + response.errorStatusCode);

                    switch (response.errorStatusCode) {
                    case 307:
                        {
                            console.log("Redirect url: " + response.redirectUrl);
                            window.location.href = response.redirectUrl;
                        }
                        break;
                    }
                }
            });

            return false;
        });
        
        $("#log-out").click(function(e) {
            e.preventDefault();
            $.ajax({
                url: "/Account/SignOut?returnUrl=" + window.location.pathname + window.location.search,
                type: "GET",
                contentType: "application/json",
                error: function(jqXhr, textStatus, errorThrown) {
                    console.log("jqXhr: " + jqXhr);
                    console.log("textStatus: " + jqXhr);
                    console.log("errorThrown: " + jqXhr);
                },
                success: function(response) {
                    window.location.href = response.redirectUrl;
                }
            });
            return false;
        });
        
        $("#write-article").click(function(e) {
            e.preventDefault();
            window.location.href = "/Articles/WriteArticle";
            return false;
        });
    });
</script>